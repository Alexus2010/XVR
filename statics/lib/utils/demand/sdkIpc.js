var deviceSdk={initVariable:function(){this.wfs,this.motionDetectionFlag=25,this.codeNull=-1,this.codeSucess=0,this.codeJump=101,this.codeError=203,this.httpOk=200,this.encodingMjpeg=3,this.encodingG711A=16,this.encodingG711U=17,this.encodingAAC=21,this.playStatus=!1,this.audioSwitch=!1,this.ptz={stop:0,zoomOut:21,zoomIn:20,top:10,down:11,left:12,right:13,focusOut:23,focusIn:22},this.clientNum=0,this.monitorPlayNum={v265:0,other:0}},init:function(a){this.videoTags=document.getElementById(a.tags),this.tag265Name=a.tag265Name,this.tags=a.tags,this.canvasEnlarge=document.getElementById("canvasEnlarge"),this.url=a.deviceIp+":"+a.devicePort,this.user=a.user,this.password=a.password,this.stream=a.stream,this.videoCode=a.videoCode,this.audioCode=a.audioCode,this.width=a.width,this.height=a.height,this.sessionID=a.sessionID,this.onCallback=a.onCallback},callHttp:function(a,c,d,b){$.ajax({type:"POST",url:"/api.html?n="+a,cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify({api:a,data:void 0===c?null:c}),complete:function(g,f){deviceSdk.codeNull;if(g.status!=deviceSdk.httpOk){return deviceSdk.httpError(b,a)}var h=$.parseJSON(g.responseText);switch(h.code=parseInt(h.code)){case deviceSdk.codeSucess:d&&d(h.data);break;case deviceSdk.codeJump:case deviceSdk.codeError:deviceSdk.httpError(b,a)}},error:function(){deviceSdk.httpError(b,a)}})},httpError:function(b,a){deviceSdk.playStatus=!1,b?b():alert(lang.labQequestFail+": "+a)},setInitData:function(b){for(var a in b){deviceSdk[a]=b[a]}},login:function(b,a,c){deviceSdk.callHttp("login",{username:b,password:a},function(d){deviceSdk.sessionID=d.Cookie.split("sessionID=")[1],c&&c()})},getVideoEncoding:function(a){deviceSdk.callHttp("getEncodingPropertyPro",null,a)},getAudioEncoding:function(a){deviceSdk.callHttp("getEncodingProperty2",{streamType:"52"},a)},play:function(b,a,c){Wfs.isSupported()&&(c="IP"==(b={openSound:b,aencType:parseInt(this.audioCode),width:this.width,height:this.height,onCallback:deviceSdk.onReceiveMessageCallback,type:null!=a?"NVR":"IP"}).type?{index:String(this.stream),sessionID:this.sessionID}:{action:"play",data:{channel:parseInt(a),stream:parseInt(c),sessionID:this.sessionID}},deviceSdk.wfs=new Wfs(b,this.tag265Name),deviceSdk.wfs.attachMedia(this.videoTags,this.url,c,this.videoCode,deviceSdk.clientNum),deviceSdk.clientNum++)},stopVideo:function(a){deviceSdk.closeSocket(a)},playAudio:function(a){null!=a&&deviceSdk.wfs.setConfig("openSound",!0,a)},stopAudio:function(a){null!=a&&deviceSdk.wfs.getConfigInfo()[a]&&deviceSdk.wfs.setConfig("openSound",!1,a)},setPtz:function(a){a=a||this.ptz.stop;deviceSdk.callHttp("pTZCtrl",{ch:"0",optType:String(a),presetPointIndex:"0",cruiseLineIndex:"0"})},closeSocket:function(a){deviceSdk.wfs&&(deviceSdk.wfs.destroy(a),deviceSdk.wfs.stopWebsocket(a)),$(this.videoTags).hide()},onOpenSocket:function(){},onCloseSocket:function(){$(this.videoTags).hide()},onReceiveMessageCallback:function(c,b,d){if(deviceSdk.onCallback){return deviceSdk.onCallback(c,b,d)}switch(c){case"video":if(b.nbMsg,deviceSdk.motionDetectionFlag,b.encodingtype==deviceSdk.encodingMjpeg){return alert(lang.labNonSupportStreamType),deviceSdk.closeSocket()}loading(!1),deviceSdk.playStatus=!0,$(deviceSdk.videoTags).show();break;case"code":loading(!1);var a=b==deviceSdk.codeError?lang.muchPrwClt:lang.labSessionIDError;alert(a);break;case"open":deviceSdk.onOpenSocket(),deviceSdk.playStatus=!1;break;case"close":deviceSdk.onCloseSocket(),deviceSdk.playStatus=!1;break;case"currPbTime":break;case"pureCode":alert(lang.muchPrwClt)}},monitorValueChange:function(b,a,c){Object.defineProperty(b,a,{get:function(){return b.label},set:function(d){if(d){return c(a,d)}}})},enlarge:function(h,m,b){var g=document.getElementById(m),f=document.getElementById(b),p=g.getContext("2d"),j=$(this.videoTags).width(),l=$(this.videoTags).height(),k=this;if(g.width=j,g.height=l,k.drawRc={},p.strokeStyle="red",!h){return $("#"+b).attr("style",""),$(g).off("mousedown").off("mouseup").off("mouseout")}$(g).on("contextmenu",function(a){a.preventDefault()}).on("mousedown",function(a){switch(a.button){case 0:k.drawRc.left=k.drawRc.right=a.offsetX,k.drawRc.top=k.drawRc.bottom=a.offsetY,k.bZoomMove=!0,$(this).on("mousemove",function(c){k.drawRc.right=c.offsetX,k.drawRc.bottom=c.offsetY,p.clearRect(0,0,g.width,g.height),p.strokeRect(k.drawRc.left,k.drawRc.top,k.drawRc.right-k.drawRc.left,k.drawRc.bottom-k.drawRc.top)});break;case 2:f.style.transform="",g.style.transform=""}}).on("mouseup",function(a){0==a.button&&0==a.button&&k.bZoomMove&&(k.drawRc.right=a.offsetX,k.drawRc.bottom=a.offsetY,k.bZoomMove=!1,$(this).off("mousemove"),p.clearRect(0,0,g.width,g.height),k.zoom(k.drawRc,$("#"+m),$("#"+b)))}).on("mousemove",function(a){$(this).off("mousemove"),k.bZoomMove&&(k.bZoomMove=!1,p.clearRect(0,0,g.width,g.height),k.zoom(k.drawRc,$("#"+m),$("#"+b)))})},zoom:function(j,p,f){if(j){if(j.left>j.right&&(b=j.left,j.left=j.right,j.right=b),j.top>j.bottom&&(b=j.top,j.top=j.bottom,j.bottom=b),j.right-j.left<4||j.bottom-j.top<4){return this.$ele}var h=p[0],g=[1,0,0,1,0,0],q=f.css("transform");if("none"!==q){g=$.map(q.substr(7,q.lastIndexOf(")")-7).split(","),function(a){return Number(a)})}else{if(10<=g[0]||10<=g[3]){return this.$ele}}var k=parseInt((g[0]-1)*h.width/2),m=parseInt((g[3]-1)*h.height/2),l=parseInt((j.left-g[4]+k)/g[0]),b=parseInt((j.top-g[5]+m)/g[3]),p=h.width/(j.right-j.left),q=h.height/(j.bottom-j.top);g[0]*=p,g[3]*=q,k=parseInt((g[0]-1)*h.width/2),m=parseInt((g[3]-1)*h.height/2),g[4]=0-l*g[0]+k,g[5]=0-b*g[3]+m,j.left=l,j.top=b,j.right=parseInt(l+h.width/g[0]),j.bottom=parseInt(b+h.height/g[3]),f.css("transform","matrix("+g.join(",")+")")}},capture:function(k,h,f,c){if((null!=h?$("#v264"+h):$("#video264")).is(":visible")){if(isSafari()){return alert(lang.screenshotTips)}var l=document.createElement("canvas"),g=l.getContext("2d"),j=c||this.videoTags,b=j.videoWidth,h=j.videoHeight;l.width=c?b:j.clientWidth,l.height=c?h:j.clientHeight,g.drawImage(j,0,0,b,h),l.toDataURL()&&k&&k(l.toDataURL())}else{deviceSdk.wfs.setH265Conver(f,"capVideo",!0),deviceSdk.wfs.setH265Conver(f,"capVideoData",""),deviceSdk.wfs.setH265Conver(f,"captureId",f),deviceSdk.monitorValueChange(deviceSdk.wfs.getH265Conver(f),"capVideoData",function(d,a){a&&k&&k(a)})}}};