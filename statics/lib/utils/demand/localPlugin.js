var apiPluginVariables={};function apiPlugin(b,a,c){this.ws=b,this.obj=a,this.url=c,apiPluginVariables={ws:b,obj:a,url:c}}apiPlugin.prototype={sendRequest:function(b,a,c){this.ws&&this.ws.websocketMessageSending({cmd:b,data:a},c)},createWindow:function(b,a){this.sendRequest("createWnd",{rect:this.getPosition(a)},b)},destroyWindow:function(a){return this.sendRequest("destroyWnd",null,a),this},moveWindow:function(b,a){this.ws.windowWidth=$(window).width(),this.sendRequest("moveWnd",{rect:b||this.getPosition()},a)},updateWindow:function(){this.sendRequest("updateWebWnd")},showWindow:function(){this.sendRequest("showWnd")},hideWindow:function(a){this.sendRequest("hideWnd","",a)},setPlayWindowNum:function(b,a){this.sendRequest("arrangeWnd",{arrangeType:parseInt(b)},a)},getCurrentWindow:function(a){this.sendRequest("getSelectWndIndex","",a)},audioAction:function(g,d,h,b,f){var c={wndIndex:parseInt(d)},d={};return h&&(c.platform=parseInt(b),d.platform=parseInt(b)),g?this.sendRequest("openSound",c,f):this.sendRequest("closeSound",d,f),g},screenshot:function(b,a,c){this.sendRequest("capture",{wndIndex:parseInt(a),fileName:String(b)},c)},startRec:function(d,c,f,b){f={wndIndex:parseInt(c),fileName:String(f)};return !d&&0!=d||(f.channel=parseInt(d)),this.sendRequest("startRecord",f,b),this},stopRec:function(b,a,c){b=a?{wndIndex:parseInt(b)}:{channel:parseInt(b)};return this.sendRequest("stopRecord",b,c),this},zoomAction:function(f,c,g,b,d){c=c?"enableZoom":"disableZoom",f={wndIndex:parseInt(f)};return g&&(f.platform=parseInt(b)),this.sendRequest(c,f,d),this},setFullScreen:function(){this.sendRequest("fullScreen",{full:!0})},startTalks:function(g,d,h,b,f,c){this.sendRequest("startTalk",{url:this.url+"/talk",requestJson:{action:"play",data:{encodeType:parseInt(g),sampleRate:parseInt(d),channelCnt:parseInt(h),bitWide:parseInt(b),sessionID:String(f)}}},c)},stopTalks:function(a){this.sendRequest("stopTalk",{requestJson:{action:"stop",data:{sessionID:String(a)}}})},getLocalConfigs:function(b,a){this.sendRequest("getLocalConfig",{deviceType:String(b)},a)},setLocalConfigs:function(h,d,j,b,f,c,g){this.sendRequest("setLocalConfig",{deviceType:String(c||getDevConf("deviceType")),localConfig:{recordFilePath:String(h),downloadFilePath:String(d),captureLivePath:String(j),capturePlaybackPath:String(b),clipsPlaybackPath:String(f)}},g)},browseFilePaths:function(a){this.sendRequest("browseFilePath",null,a)},startPreview:function(k,w,h,q,x,j,b,g,l,f,m,v){x&&""!=x||(x=2);h={url:String(this.url),requestJson:{action:"play",data:{stream:parseInt(w),sessionID:String(f)}},playParam:{videoCoder:parseInt(q),audioCoder:parseInt(x),frameRate:parseInt(j),bitRate:parseInt(b),width:parseInt(g),height:parseInt(l)},wndIndex:parseInt(h)};m||(h.requestJson.data.channel=parseInt(k)),this.sendRequest("startPlay",h,v)},stopPreview:function(b,a,c){return this.sendRequest("stopPlay",{requestJson:{action:"stop",data:{sessionID:String(a)}},channel:parseInt(b)},c),this},getBitRates:function(b,a){this.sendRequest("getBitRate",{channel:parseInt(b)},a)},setDrawPTZ:function(b,a){this.sendRequest("setDrawPTZRate",{channel:parseInt(a),rate:Number(b)})},isCorridorMode:function(b,a,c){this.sendRequest("corridorModeStatus",{channel:parseInt(a),status:b},c)},startPlayBacks:function(x,C,k,A,D,q,b,j,y,g,z,B,m,w,v){q&&""!=q||(q=96),m=m||"0";B={fileType:parseInt(k),startTime:String(A),endTime:String(D),sessionID:String(B),speed:0};w?B.seekTime=String(m):(B.channel=parseInt(C),B.streamNo=0),this.sendRequest("startPlayBack",{wndIndex:parseInt(x),url:this.url+"/playback",requestJson:{action:"play",data:B},playParam:{videoCoder:parseInt(q),audioCoder:parseInt(b),frameRate:parseInt(j),bitRate:parseInt(y),width:parseInt(g),height:parseInt(z)}},v)},pausePlayBacks:function(b,a,c){this.sendRequest("pausePlayBack",{requestJson:{action:"pause",data:{sessionID:String(a)}},wndIndex:parseInt(b)},c)},resumePlayBacks:function(b,a,c){this.sendRequest("resumePlayBack",{requestJson:{action:"continue",data:{sessionID:String(a)}},wndIndex:parseInt(b)},c)},stopPlayBacks:function(b,a,c){this.sendRequest("stopPlayBack",{requestJson:{action:"stop",data:{sessionID:String(a)}},wndIndex:parseInt(b)},c)},setPlaybackSpeeds:function(b,a,c){this.sendRequest("setPlaybackSpeed",{requestJson:{action:"setSpeed",data:{speed:parseInt(a),sessionID:String(c)}},wndIndex:parseInt(b)})},getPlayBackCurrentTime:function(b,a){b={wndIndex:parseInt(b)};null!=a&&(b.platform=parseInt(a)),this.sendRequest("getOSDTime",b)},downloadRecordFileStart:function(k,u,h,q,v,j,b,g,l,f,m){f={fileType:parseInt(j),startTime:String(h),endTime:String(q),sessionID:String(f)};m?(f.fileSize=String(g),f.seekTime="0"):(f.channel=parseInt(k),f.streamNo=0,f.speed=0,f.format="RAW"),this.sendRequest("startDownload",{url:this.url+"/playback",requestJson:{action:"download",data:f},fileSize:String(g),fileName:String(l)})},downloadRecordFileStop:function(a){this.sendRequest("stopDownload",{requestJson:{action:"stopDownload",data:{sessionID:String(a)}}})},openFloder:function(b,a){this.sendRequest("openDownloadFloder",{filePath:String(b)},a)},loginPlatform:function(a){this.sendRequest("loginPlatform",{loginType:parseInt(a.loginType),platform:{Bitvision:{userName:String(a.userName),regionAddr:String(a.regionAddr),regionPort:parseInt(a.regionPort)},Aliyun:{appKey:String(a.appKey),appSecret:String(a.appSecret),authCode:String(a.authCode),countyCode:String(a.countyCode)}}})},bvWebconnect:function(){this.sendRequest("webconnect")},isP2PCapture:function(d,c,f,b){f={platform:parseInt(d),fileName:String(c),wndIndex:parseInt(f)};this.sendRequest("capture",f,b)},startP2PRecord:function(d,c,f,b){f={platform:parseInt(d),fileName:String(c),wndIndex:parseInt(f)};this.sendRequest("startRecord",f,b)},stopP2PRecord:function(b,a,c){a={platform:parseInt(b),wndIndex:parseInt(a)};this.sendRequest("stopRecord",a,c)},startP2PPtz:function(d,c,f,b){f={platform:parseInt(d),param:{channelId:parseInt(c),ptzCommand:parseInt(f)}};this.sendRequest("startPtzControl",f,b)},startP2PTalks:function(j,m,g,l,q,h,b,f,k){var c={platform:parseInt(j),param:{}};switch(parseInt(j)){case 0:c.param.deviceSn=String(m),c.param.devUsername=String(g),c.param.devPasswd=String(l),c.param.channelId=parseInt(h),c.param.needDecrypt=parseInt(q);break;case 1:c.param.channelGuid=String(b),c.param.encodeType=parseInt(f)}this.sendRequest("startTalk",c,k)},stopP2PTalks:function(a){this.sendRequest("stopTalk",{platform:parseInt(a)})},showP2PChannel:function(b,a){this.sendRequest("showChannelNo",{platform:parseInt(b),show:a})},setP2PLocalConfig:function(b,a,c){this.sendRequest("setLocalConfig",{deviceType:a,localConfig:{savePath:b}},c)},startP2PPreview:function(k,u,h,q,v,j,b,g,l,f){var m={platform:parseInt(k),param:{wndIndex:parseInt(g)}};switch(parseInt(k)){case 0:m.param.deviceSn=String(h),m.param.devUsername=String(q),m.param.devPasswd=String(v),m.param.channelId=parseInt(j),m.param.streamId=parseInt(b),m.param.needDecrypt=parseInt(l);break;case 1:m.param.channelGuid=String(u),m.param.channelId=parseInt(j),m.param.streamId=parseInt(b)}this.sendRequest("startP2PPlay",m,f)},stopP2PPreview:function(b,a,c){a={platform:parseInt(b),param:{channelId:parseInt(a)}};this.sendRequest("stopP2PPlay",a,c)},searchP2PRecordFile:function(m,y,h,w,z,k,b,g,q,f,v,x){var j={platform:parseInt(m),param:{fileType:parseInt(g),startTime:String(q),endTime:String(f)}};switch(parseInt(m)){case 0:j.param.deviceSn=String(y),j.param.devUsername=String(h),j.param.devPasswd=String(w),j.param.channelId=parseInt(k),j.param.streamId=parseInt(b),j.param.needDecrypt=parseInt(z);break;case 1:j.param.channelGuid=String(v)}this.sendRequest("searchRecordFile",j,x)},startP2PPlayBacks:function(x,C,k,A,D,q,b,j,y,g,z,B,m,w){var v={platform:parseInt(x),param:{fileType:parseInt(j),startTime:String(y),endTime:String(g),wndIndex:parseInt(z),channelId:parseInt(q)}};switch(parseInt(x)){case 0:v.param.deviceSn=String(C),v.param.devUsername=String(k),v.param.devPasswd=String(A),v.param.streamId=parseInt(b),v.param.needDecrypt=parseInt(D);break;case 1:v.param.channelGuid=String(B),v.param.offset=String(m)}this.sendRequest("startP2PPlayBack",v,w)},startP2PDrag:function(h,d,j,b,f,c,g){c={platform:parseInt(h),param:{channelId:parseInt(d),streamId:parseInt(j),fileType:parseInt(b),startTime:String(f),endTime:String(c)}};this.sendRequest("skipRecordStream",c,g)},stopP2PPlayBacks:function(b,a,c){a={platform:parseInt(b),param:{channelId:parseInt(a)}};this.sendRequest("stopP2PPlayBack",a,c)},setNumForOnePage:function(b,a){this.sendRequest("setNumForOnePage",{number:parseInt(b)},a)},showFirstPage:function(a){this.sendRequest("showFirstPage",{type:parseInt(a)})},showNextPage:function(a){this.sendRequest("showNextPage",{type:parseInt(a)})},searchByMonth:function(d,c,f,b){f={type:parseInt(d),startTime:String(c),endTime:String(f)};this.sendRequest("searchByMonth",f,b)},deleteLocalFile:function(b,a,c){a={type:parseInt(b),filePath:String(a)};this.sendRequest("deleteLocalFile",a,c)},getPosition:function(h){var d=this.obj||apiPluginVariables.obj,j=d.offset().top-$(document).scrollTop(),b=d.offset().left-$(document).scrollLeft(),f=d.height(),c=d.width(),g=0,d=window.navigator.userAgent;return h&&(b=parseInt(b*h),j=parseInt(j*h),c=parseInt(c*h),f=parseInt(f*h)),(-1<d.indexOf("Firefox")||this.isEdgeVersion()<19)&&(g=h?parseInt(window.innerHeight*h):window.innerHeight),(1<=d.indexOf("Trident")||-1!==d.indexOf("compatible")&&-1!==d.indexOf("MSIE")&&-1===d.indexOf("Opera"))&&(g=-1),{left:parseInt(b),top:parseInt(j),width:parseInt(c),height:parseInt(f),bodyHeight:parseInt(g)}},isEdgeVersion:function(){var b="",a=navigator.userAgent.toLowerCase().match(/(edge|edg)\/([\d.]+)/);return a&&(b=a[2]),parseInt(b)},browserListenEvents:function(){var a=!1;(a="visible"==document.visibilityState)&&this.ws.windowWidth==$(window).width()&&($(document).attr("title",this.ws.uuid),this.updateWindow(),this.ws.windowWidth=$(window).width()),a?this.showWindow():this.hideWindow()},addBrowserListenEvents:function(a){document.addEventListener&&document.addEventListener("visibilitychange",a)},removeBrowserListenEvents:function(a){document.removeEventListener("visibilitychange",a)},open:function(a){loading(!0),this.ws||(this.ws=apiPluginVariables.ws,this.url=apiPluginVariables.url),a=a||versionconfig.web_version,this.sendRequest("webconnect",{webVersion:a})},webconnect:function(a){if(this.getLocalConfigs(getDevConf("deviceType")),localServerWebsocket.uuid=a.uuid,localServerWebsocket.windowWidth=$(window).width(),comparePluginVersions(a.data.version,versionconfig.plugin_version)&&updatePlugin(),getConf("isHidePlugin")){return loading(!1)}$(document).attr("title",localServerWebsocket.uuid),this.destroyWindow()},destroyWnd:function(){this.createWindow()},createWnd:function(a){if(loading(!1),0!=a.data.errorCode){return alert(lang.createWindowFail)}this.setPlayWindowNum(localServerWebsocket.windowNum),onImplement()},updateWebWnd:function(){"function"==typeof onUpdateWindow&&onUpdateWindow(),"function"==typeof onImplement&&onImplement()},onGetSelectWndIndex:function(a){"function"==typeof setConf&&setConf("selectWindowIndex",a.data.wndIndex),onSelectWindowChange(a.data.wndIndex)},getLocalConfig:function(a){"function"==typeof setConf&&setConf("localConfig",a.data.localConfig)},getOSDTime:function(a){"function"==typeof setConf&&setConf("getOSDTime",a.data.osdTime),"function"==typeof onOSDTime&&onOSDTime(a.data.osdTime)},startPlay:function(a){"function"==typeof onStartPlay&&onStartPlay(a.data.errorCode)},startRecord:function(a){"function"==typeof onRecord&&onRecord(a.data.errorCode)},startDownload:function(a){"function"==typeof onDownload&&onDownload(a.data.errorCode)},startPlayBack:function(a){"function"==typeof onStartPlayBack&&onStartPlayBack(a.data.errorCode,a.data.wndIndex)},startTalk:function(a){"function"==typeof onStartTalk&&onStartTalk(a.data.errorCode)},openSound:function(a){"function"==typeof onOpenSound&&onOpenSound(a.data.errorCode)},playbackFileEnd:function(a){"function"==typeof onPlaybackFileEnd&&onPlaybackFileEnd(a.data.stopTime,a.data.wndIndex)},downloadProgress:function(a){"function"==typeof getUpdateProcess&&getUpdateProcess(a.data.progress)},downloadStartTime:function(a){"function"==typeof getFileIndex&&getFileIndex(a.data.startTime)},browseFilePath:function(a){"function"==typeof onSetPath&&onSetPath("path",a.data.filePath)},setLocalConfig:function(a){"function"==typeof getDevConf&&this.getLocalConfigs(getDevConf("deviceType")),"function"==typeof onSetPath&&onSetPath("result",a.data.errorCode)},getBitRate:function(a){onBitRate(a.data.bitRate)},corridorModeStatus:function(a){"function"==typeof onCorridorModeStatus&&onCorridorModeStatus(a.data.errorCode)}};