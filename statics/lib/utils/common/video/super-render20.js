"use strict";var vertexYUVShader=["#version 300 es","layout(location = 0) in vec4 vertexPos;","layout(location = 1) in vec2 texturePos;","out vec2 textureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos;","}"].join("\n"),fragmentYUVShader=["#version 300 es","precision highp float;","in vec2 textureCoord;","out vec4 fragColor;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","void main(void) {","float y = texture(ySampler,  textureCoord).r;","float u = texture(uSampler,  textureCoord).r;","float v = texture(vSampler,  textureCoord).r;","fragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),vertexLineShader=["#version 300 es","layout(location = 0) in vec4 vertexPosLine;","void main()","{","gl_Position = vertexPosLine;","}"].join("\n"),fragmentLineShader=["#version 300 es","precision highp float;","uniform mediump float fRcom;","uniform mediump float fGcom;","uniform mediump float fBcom;","out vec4 fragColor;","void main()","{","fragColor = vec4(fRcom,fGcom,fBcom,1.0);","}"].join("\n");!function(b){function a(c){this.canvasElement=document.getElementById(c),this.initContextGL(),this.contextGL&&(this.YUVProgram=this.initProgram(vertexYUVShader,fragmentYUVShader),this.LineProgram=this.initProgram(vertexLineShader,fragmentLineShader),this.initBuffers(),this.initTextures())}b.SuperRender=(a.prototype.initContextGL=function(){var d=this.canvasElement,c=null;try{c=d.getContext("webgl2")}catch(d){c=null}c&&"function"==typeof c.getParameter||(c=null),this.contextGL=c,console.log("WebGL2.0")},a.prototype.initProgram=function(g,d){var f=this.contextGL,c=f.createShader(f.VERTEX_SHADER);f.shaderSource(c,g),f.compileShader(c),f.getShaderParameter(c,f.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+f.getShaderInfoLog(c));g=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(g,d),f.compileShader(g),f.getShaderParameter(g,f.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+f.getShaderInfoLog(g));d=f.createProgram();return f.attachShader(d,c),f.attachShader(d,g),f.linkProgram(d),f.getProgramParameter(d,f.LINK_STATUS)||console.log("Program failed to compile: "+f.getProgramInfoLog(d)),f.deleteShader(c),f.deleteShader(g),d},a.prototype.initBuffers=function(){var g=this.contextGL,d=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,d),g.bufferData(g.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),g.STATIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null);var f=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,f),g.bufferData(g.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),g.DYNAMIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null);var c=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,c),g.bufferData(g.ARRAY_BUFFER,16,g.DYNAMIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null),this.vertexPosBuffer=d,this.texturePosBuffer=f,this.vertexLineBuffer=c},a.prototype.initTextures=function(){var g=this.contextGL,d=this.YUVProgram;g.useProgram(d);var f=this.initTexture(),c=g.getUniformLocation(d,"ySampler");g.uniform1i(c,0),this.yTextureRef=f;c=this.initTexture(),f=g.getUniformLocation(d,"uSampler");g.uniform1i(f,1),this.uTextureRef=c;c=this.initTexture(),d=g.getUniformLocation(d,"vSampler");g.uniform1i(d,2),this.vTextureRef=c,g.useProgram(null)},a.prototype.initTexture=function(){var d=this.contextGL,c=d.createTexture();return d.bindTexture(d.TEXTURE_2D,c),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,null),c},a.prototype.SR_DisplayFrameData=function(k,p,c,h,d){if(!(k<=0||p<=0)){var l=this.contextGL;if(null==c){return l.clearColor(0,0,0,0),void l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)}var g=this.canvasElement;g.width=k,g.height=p,this.nWindowWidth=g.width,this.nWindowHeight=g.height;var m=this.nWindowWidth,j=this.nWindowHeight;l.clearColor(0.8,0.8,1,1),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.viewport(0,0,m,j),this.updateFrameData(k,p,c);k=this.YUVProgram;l.useProgram(k);p=this.vertexPosBuffer;l.bindBuffer(l.ARRAY_BUFFER,p);c=l.getAttribLocation(k,"vertexPos");l.enableVertexAttribArray(c),l.vertexAttribPointer(c,2,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,null);p=this.texturePosBuffer;l.bindBuffer(l.ARRAY_BUFFER,p);k=l.getAttribLocation(k,"texturePos");l.enableVertexAttribArray(k),l.vertexAttribPointer(k,2,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,null),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.disableVertexAttribArray(c),l.disableVertexAttribArray(k),l.useProgram(null),h&&d==this.captureId&&(this.capVideoData=g.toDataURL(),this.captureId="",this.capVideo=!1)}},a.prototype.updateFrameData=function(k,p,c){var h=this.contextGL,d=this.yTextureRef,l=this.uTextureRef,g=this.vTextureRef,m=c,j=k*p,c=m.subarray(0,j);h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,d),h.texImage2D(h.TEXTURE_2D,0,h.LUMINANCE,k,p,0,h.LUMINANCE,h.UNSIGNED_BYTE,c);d=k/2*p/2,c=m.subarray(j,j+d);h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,l),h.texImage2D(h.TEXTURE_2D,0,h.LUMINANCE,k/2,p/2,0,h.LUMINANCE,h.UNSIGNED_BYTE,c);d=m.subarray(j+d,j+d+d);h.activeTexture(h.TEXTURE2),h.bindTexture(h.TEXTURE_2D,g),h.texImage2D(h.TEXTURE_2D,0,h.LUMINANCE,k/2,p/2,0,h.LUMINANCE,h.UNSIGNED_BYTE,d)},a.prototype.SR_DrawLine=function(k,p,c,h){var d=this.contextGL,l=this.nWindowWidth,g=this.nWindowHeight,m=this.LineProgram;d.useProgram(m);var j=d.getUniformLocation(m,"fRcom");d.uniform1f(j,c.fR);j=d.getUniformLocation(m,"fGcom");d.uniform1f(j,c.fG);j=d.getUniformLocation(m,"fBcom");d.uniform1f(j,c.fB);c=k.fX/l*2-1,k=-k.fY/g*2+1,l=p.fX/l*2-1,p=-p.fY/g*2+1,g=this.vertexLineBuffer;d.bindBuffer(d.ARRAY_BUFFER,g),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array([c,k,l,p]));m=d.getAttribLocation(m,"vertexPosLine");d.enableVertexAttribArray(m),d.vertexAttribPointer(m,2,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,null),d.drawArrays(d.LINES,0,2),d.disableVertexAttribArray(m),d.useProgram(null)},a.prototype.SR_SetDisplayRect=function(j){var g,h,f=this.contextGL,k=this.nWindowWidth,c=this.nWindowHeight,l=null;l=j&&0<k&&0<c?(g=j.left/k,h=j.top/c,k=j.right/k,d=j.bottom/c,new Float32Array([k,h,g,h,k,d,g,d])):new Float32Array([1,0,0,0,1,1,0,1]);var d=this.texturePosBuffer;f.bindBuffer(f.ARRAY_BUFFER,d),f.bufferSubData(f.ARRAY_BUFFER,0,l),f.bindBuffer(f.ARRAY_BUFFER,null)},a.prototype.SR_Destroy=function(){var g=this.contextGL,d=this.YUVProgram;g.deleteProgram(d);var f=this.LineProgram;g.deleteProgram(f);var c=this.vertexPosBuffer,d=this.texturePosBuffer,f=this.vertexLineBuffer;g.deleteBuffer(c),g.deleteBuffer(d),g.deleteBuffer(f);c=this.yTextureRef,d=this.uTextureRef,f=this.vTextureRef;g.deleteTexture(c),g.deleteTexture(d),g.deleteTexture(f)},a)}(this);