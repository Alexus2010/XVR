function PCMPlayer(a){/Safari/.test(window.navigator.userAgent)&&!/Chrome/.test(window.navigator.userAgent)||this.init(a)}PCMPlayer.prototype.init=function(a){this.option=$.extend({encoding:"16bitInt",channels:1,sampleRate:8000,flushingTime:1000},a),this.samples=new Float32Array,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.typedArray=this.getTypedArray(),this.createContext()},PCMPlayer.prototype.getMaxValue=function(){var a={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return a[this.option.encoding]||a["16bitInt"]},PCMPlayer.prototype.getTypedArray=function(){var a={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return a[this.option.encoding]||a["16bitInt"]},PCMPlayer.prototype.createContext=function(){window.AudioContext||window.webkitAudioContext?(this.audioCtx=new (window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime):this.audioNoSupport=!0},PCMPlayer.prototype.isTypedArray=function(a){return a.byteLength&&a.buffer&&a.buffer.constructor==ArrayBuffer},PCMPlayer.prototype.feed=function(a){var b;this.isTypedArray(a)&&!this.audioNoSupport&&(a=this.getFormatedValue(a),(b=new Float32Array(this.samples.length+a.length)).set(this.samples,0),b.set(a,this.samples.length),this.samples=b)},PCMPlayer.prototype.getFormatedValue=function(b){for(var b=new this.typedArray(b.buffer),c=new Float32Array(b.length),a=0;a<b.length;a++){c[a]=b[a]/this.maxValue}return c},PCMPlayer.prototype.volume=function(a){this.gainNode.gain.value=a},PCMPlayer.prototype.destroy=function(){/Safari/.test(window.navigator.userAgent)&&!/Chrome/.test(window.navigator.userAgent)||(this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx&&this.audioCtx.close(),this.audioCtx=null)},PCMPlayer.prototype.flush=function(){if(this.samples.length){for(var d,h,c,k,b=this.audioCtx.createBufferSource(),j=this.samples.length/this.option.channels,g=this.audioCtx.createBuffer(this.option.channels,j,this.option.sampleRate),f=0;f<this.option.channels;f++){for(d=g.getChannelData(f),h=f,k=50,c=0;c<j;c++){d[c]=this.samples[h],c<50&&(d[c]=d[c]*c/50),j-51<=c&&(d[c]=d[c]*k--/50),h+=this.option.channels}}this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),b.buffer=g,b.connect(this.gainNode),b.start(this.startTime),this.startTime+=g.duration,this.samples=new Float32Array}};